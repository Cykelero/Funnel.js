# Extending Funnel

Using the `Funnel.add` object, you can extend the options Funnel offers when funneling fonctions.

## Adding filter functions

You can add filter functions for use when defining a signature's filters.

To add a filter function, call the `Funnel.add.filterFunction` method with the following arguments:

- `name`: The name under which your filter function will be made available.
- `behavior`: The function defining the behavior of your filter function.

The `behavior` function receives three arguments, and can use its `this` object to access the current state of the funneling.

The three arguments are as follows:

- `key`: A string containing the name of the argument being affected by the filter function. If the filter function is used with multiple keys, your behavior function will be called once for each key.
- `action`: A function allowing you to execute the user's value provider. This function returns the value generated by the value provider.  
  You can inject additional arguments into the value provider by passing a map to the `action` function. The argument names you provide will automatically be prefixed with an underscore.
- `extra`: An array containing any additional values specified by the user.

The `this` object currently has a single property, `args`. Use this map to both get and set arguments.

### Examples

As examples, here are the filter function definitions for `set`, `default` and `in`.

```javascript
Funnel.add.filterFunction("set", function(key, action) {
	this.args[key] = action();
});

Funnel.add.filterFunction("default", function(key, action) {
	if (this.args[key] === undefined) this.args[key] = action();
});

Funnel.add.filterFunction("in", function(key, action, extra) {
	var allowedValues = action(),
		defaultIndex = parseInt(extra[0]) || 0;
	
	if (allowedValues.indexOf(this.args[key]) == -1) {
		this.args[key] = allowedValues[defaultIndex];
	}
});
```
